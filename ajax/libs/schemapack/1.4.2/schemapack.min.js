"use strict";function addTypeAlias(e,t){var r=Object.keys(readTypeDictStr);if(r.indexOf(t)<0)throw new TypeError("Underlying type does not exist. Typo?");aliasTypes[e]=t}function getDataType(e){var t=Object.keys(readTypeDictStr),r=e.trim().toLowerCase();if(aliasTypes.hasOwnProperty(r)&&(r=aliasTypes[r]),t.indexOf(r)===-1)throw new TypeError("Invalid data type for schema: "+e+" -> "+r);return r}function setValidateByDefault(e){validateByDefault=e}function setStringEncoding(e){var t=e.trim().toLowerCase(),r=["ascii","utf8","utf16le","ucs2","base64","binary","hex"];if(!(r.indexOf(t)>-1))throw new TypeError("String encoding not available");strEnc=t}function writeVarUInt(e,t){for(;e>127;)t[bag.byteOffset++]=127&e|128,e>>=7;t[bag.byteOffset++]=127&e}function writeVarInt(e,t){writeVarUInt(e<<1^e>>31,t)}function readVarUInt(e){var t,r=0,n=0;do t=e[bag.byteOffset++],r|=(127&t)<<7*n,n++;while(128&t);return r}function readVarInt(e){var t=readVarUInt(e);return t>>>1^-(1&t)}function writeString(e,t){var r=Buffer.byteLength(e||"",strEnc);writeVarUInt(r,t),bag.byteOffset+=t.write(e||"",bag.byteOffset,r,strEnc)}function readString(e){var t=readVarUInt(e),r=e.toString(strEnc,bag.byteOffset,bag.byteOffset+t);return bag.byteOffset+=t,r}function writeBuffer(e,t){var r=e.length;writeVarUInt(r,t),e.copy(t,bag.byteOffset),bag.byteOffset+=r}function readBuffer(e){var t=readVarUInt(e),r=allocUnsafe(t);return e.copy(r,0,bag.byteOffset,bag.byteOffset+t),bag.byteOffset+=t,r}function getWriteTypeDictStr(e,t){switch(e){case"boolean":return"bag.byteOffset = wBuffer.writeUInt8("+t+" ? 1 : 0, bag.byteOffset, true);";case"int8":return"bag.byteOffset = wBuffer.writeInt8("+t+", bag.byteOffset, true);";case"uint8":return"bag.byteOffset = wBuffer.writeUInt8("+t+", bag.byteOffset, true);";case"int16":return"bag.byteOffset = wBuffer.writeInt16BE("+t+", bag.byteOffset, true);";case"uint16":return"bag.byteOffset = wBuffer.writeUInt16BE("+t+", bag.byteOffset, true);";case"int32":return"bag.byteOffset = wBuffer.writeInt32BE("+t+", bag.byteOffset, true);";case"uint32":return"bag.byteOffset = wBuffer.writeUInt32BE("+t+", bag.byteOffset, true);";case"float32":return"bag.byteOffset = wBuffer.writeFloatBE("+t+", bag.byteOffset, true);";case"float64":return"bag.byteOffset = wBuffer.writeDoubleBE("+t+", bag.byteOffset, true);";case"string":return"bag.writeString("+t+", wBuffer);";case"varuint":return"bag.writeVarUInt("+t+", wBuffer);";case"varint":return"bag.writeVarInt("+t+", wBuffer);";case"buffer":return"bag.writeBuffer("+t+", wBuffer);"}}function getVarUIntByteLength(e){return e<=0?1:Math.floor(Math.log(e)/Math.log(128))+1}function getVarIntByteLength(e){return getVarUIntByteLength(e<<1^e>>31)}function processArrayEnd(e,t,r,n,a){var f=n<=1?t:t+"xn",u=void 0===a?"ref"+f+".length":a,o="j"+t;return"for (var "+o+"="+(e.length-1)+";"+o+"<"+u+";"+o+"++) { "+r+"}"}function getArrayLengthByteCount(e){return"byteC+=bag.getVarUIntByteLength(ref"+e+".length);"}function encodeArrayLength(e){return"bag.writeVarUInt(ref"+e+".length,wBuffer);"}function decodeArrayLength(e){return"var "+e+"=bag.readVarUInt(buffer);"}function declareDecodeRef(e,t,r,n){return"var ref"+e+"="+n+"; ref"+t+"["+r+"]=ref"+e+";"}function declareEncodeRef(e,t,r){return"var ref"+e+"=ref"+t+"["+r+"];"}function declareRepeatRefs(e,t,r,n,a,f,u,o){var i=(getXN(f,t),getXN(f,r)),g=e?"j"+r:n;f[f.length-1]+=declareEncodeRef(t+"xn",i,g),u[u.length-1]+=declareDecodeRef(t+"xn",i,g,a),o[o.length-1]+=declareEncodeRef(t+"xn",i,g)}function throwTypeError(e,t,r,n,a){if(typeof e!==t)throw new TypeError(e+" does not match the type of "+t);if(void 0!==r&&e<r)throw new TypeError(e+" is less than minimum allowed value of "+r+" for schema type "+a);if(void 0!==n&&e>n)throw new TypeError(e+" is greater than maximum allowed value of "+n+" for schema type "+a)}function getCheckBufferStr(e){var t="bag.throwTypeError("+e+",'Buffer or Uint8Array');";return"if ("+e+" instanceof Uint8Array === false && "+e+" instanceof Buffer === false){"+t+"}"}function getCheckDataTypeStr(e,t){var r="bag.throwTypeError("+e+",'"+t+"');";return"if (typeof("+e+") !== '"+t+"'){"+r+"}"}function getBoundsCheckStr(e,t,r,n){var a="bag.throwTypeError("+e+",'number',"+t+","+r+",'"+n+"');";return"if (typeof("+e+") !== 'number'||"+e+"<"+t+"||"+e+">"+r+"){"+a+"}"}function validateDataType(e,t){var r=3.4028234663852886e38;switch(e){case"boolean":return getCheckDataTypeStr(t,"boolean");case"int8":return getBoundsCheckStr(t,-128,127,"int8");case"uint8":return getBoundsCheckStr(t,0,255,"uint8");case"int16":return getBoundsCheckStr(t,-32768,32767,"int16");case"uint16":return getBoundsCheckStr(t,0,65535,"uint16");case"int32":return getBoundsCheckStr(t,-2147483648,2147483647,"int32");case"uint32":return getBoundsCheckStr(t,0,4294967295,"uint32");case"float32":return getBoundsCheckStr(t,-r,r,"float32");case"float64":return getBoundsCheckStr(t,-Number.MAX_VALUE,Number.MAX_VALUE,"float64");case"string":return getCheckDataTypeStr(t,"string");case"varuint":return getBoundsCheckStr(t,0,2147483647,"varuint");case"varint":return getBoundsCheckStr(t,-1073741824,1073741823,"varint");case"buffer":return getCheckBufferStr(t)}}function encodeValue(e,t,r,n){var a="ref"+t+r;return(n?validateDataType(e,a):"")+getWriteTypeDictStr(e,a)}function decodeValue(e,t,r){return"ref"+t+r+"="+readTypeDictStr[e]}function encodeByteCount(e,t,r){var n=constantByteCounts.hasOwnProperty(e);return n?"byteC+="+constantByteCounts[e]+";":"byteC+=bag.dynamicByteCounts['"+e+"'](ref"+t+r+");"}function getXN(e,t){return e.length<=2&&e[e.length-1].length<=0?t:t+"xn"}function getCompiledSchema(e,t){function r(e,d){o++;var l=Object.keys(e);l.sort(function(e,t){return e<t?-1:e>t?1:0});for(var h=o,B=0;B<l.length;B++){var w=l[B],p=e[w];d&&(w=+w);var v="number"==typeof w?w:"'"+w+"'",O=p.constructor===Array?"[]":"{}",I=d&&B>=l.length-1;if(I&&(i.push(""),g.push(""),b.push("")),p.constructor===Array){var V=o+1,E=i.length<=1?V:V+"xn",U="arrLen"+o;1===i.length&&(u+=declareEncodeRef(V,h,v),a+=declareDecodeRef(V,h,v,"[]"));var C=encodeArrayLength(E),S=decodeArrayLength(U),T=getArrayLengthByteCount(E);declareRepeatRefs(I,V,h,v,O,i,g,b),r(p,!0),c=C+processArrayEnd(p,V,i.pop()+c,i.length),s=S+processArrayEnd(p,V,g.pop()+s,i.length,U),y=T+processArrayEnd(p,V,b.pop()+y,i.length),1===i.length&&(n+=c,c="",a+=s,s="",f+=y,y="")}else if("object"==typeof p){var V=o+1;1===i.length&&(u+=declareEncodeRef(V,h,v),a+=declareDecodeRef(V,h,v,"{}")),declareRepeatRefs(I,V,h,v,O,i,g,b),r(p,!1)}else{var m=d?"":"["+v+"]",D=getDataType(p);e[w]=D;var E=getXN(i,h);if(d&&(E+=I?"[j"+h+"]":"["+B+"]"),i[i.length-1]+=encodeValue(D,E,m,t),g[g.length-1]+=decodeValue(D,E,m),b[b.length-1]+=encodeByteCount(D,E,m),i.length>1)continue;var L=d?h+"["+B+"]":h;n+=encodeValue(D,L,m,t),a+=decodeValue(D,L,m),f+=encodeByteCount(D,L,m)}}}var n="bag.byteOffset=0;",a="var ref1={}; bag.byteOffset=0;",f="",u="var ref1=json;",o=0,i=[""],g=[""],b=[""],c="",s="",y="";e={a:e},r(e,!1),f="var byteC=0;".concat(f,"var wBuffer=bag.allocUnsafe(byteC);"),n=u.concat(f,n,"return wBuffer;"),a=a.concat("return ref1['a'];");var d=new Function("json","bag",n),l=new Function("buffer","bag",a);return[d,l]}function build(e,t){var r=getCompiledSchema(e,void 0===t?validateByDefault:t),n=r[0],a=r[1];return{encode:function(e){var t={a:e};return n(t,bag)},decode:function(e){var t=Buffer.isBuffer(e)?e:bufferFrom(e);return a(t,bag)}}}var Buffer=require("buffer").Buffer,strEnc="utf8",validateByDefault=!0,aliasTypes={},readTypeDictStr={boolean:"!!buffer.readUInt8(bag.byteOffset, true); bag.byteOffset += 1;",int8:"buffer.readInt8(bag.byteOffset, true); bag.byteOffset += 1;",uint8:"buffer.readUInt8(bag.byteOffset, true); bag.byteOffset += 1;",int16:"buffer.readInt16BE(bag.byteOffset, true); bag.byteOffset += 2;",uint16:"buffer.readUInt16BE(bag.byteOffset, true); bag.byteOffset += 2;",int32:"buffer.readInt32BE(bag.byteOffset, true); bag.byteOffset += 4;",uint32:"buffer.readUInt32BE(bag.byteOffset, true); bag.byteOffset += 4;",float32:"buffer.readFloatBE(bag.byteOffset, true); bag.byteOffset += 4;",float64:"buffer.readDoubleBE(bag.byteOffset, true); bag.byteOffset += 8;",string:"bag.readString(buffer);",varuint:"bag.readVarUInt(buffer);",varint:"bag.readVarInt(buffer);",buffer:"bag.readBuffer(buffer);"},constantByteCounts={boolean:1,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},dynamicByteCounts={string:function(e){var t=Buffer.byteLength(e,strEnc);return getVarUIntByteLength(t)+t},varuint:function(e){return getVarUIntByteLength(e)},varint:function(e){return getVarIntByteLength(e)},buffer:function(e){var t=e.length;return getVarUIntByteLength(t)+t}},allocUnsafe=Buffer.allocUnsafe?function(e){return Buffer.allocUnsafe(e)}:function(e){return new Buffer(e)},bufferFrom=Buffer.from?function(e){return Buffer.from(e)}:function(e){return new Buffer(e)},bag={};bag.allocUnsafe=allocUnsafe,bag.getVarUIntByteLength=getVarUIntByteLength,bag.dynamicByteCounts=dynamicByteCounts,bag.readVarUInt=readVarUInt,bag.readVarInt=readVarInt,bag.writeVarUInt=writeVarUInt,bag.writeVarInt=writeVarInt,bag.readString=readString,bag.writeString=writeString,bag.readBuffer=readBuffer,bag.writeBuffer=writeBuffer,bag.throwTypeError=throwTypeError,bag.byteOffset=0,addTypeAlias("bool","boolean"),module.exports=exports={build:build,addTypeAlias:addTypeAlias,setStringEncoding:setStringEncoding,setValidateByDefault:setValidateByDefault};
//# sourceMappingURL=schemapack.min.js.map